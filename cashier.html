<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ë–∞—Ä | –ö–∞—Å—Å–∏—Ä</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="firebase-config.js"></script>
</head>
<body>
  <h2>üì• –í—Ö–æ–¥—è—â–∏–µ –∑–∞–∫–∞–∑—ã</h2>
  <div id="orders"></div>

  <script>
    const ordersDiv = document.getElementById("orders");

    db.ref("orders").on("child_added", (snap) => {
      const data = snap.val();
      const key = snap.key;

      const card = document.createElement("div");
      card.className = "product";
      card.innerHTML = `
        <h3>üë§ ${data.user}</h3>
        <ul>${data.cart.map(item => `<li>${item.name} - ${item.price} ‚Ç∏</li>`).join('')}</ul>
        <b>–ò—Ç–æ–≥–æ: ${data.total} ‚Ç∏</b><br>
        <button onclick="completeOrder('${key}', ${JSON.stringify(data).replace(/"/g, '&quot;')})">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
      `;
      ordersDiv.prepend(card);
    });

    function completeOrder(key, orderData) {
      // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –∞—Ä—Ö–∏–≤ ‚Äî –∏–º–∏—Ç–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ date.json (—Ñ–∞–π–ª —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é —Å —Å–µ—Ä–≤–µ—Ä–∞)
      const completed = JSON.parse(localStorage.getItem("completedOrders") || "[]");
      completed.push(orderData);
      localStorage.setItem("completedOrders", JSON.stringify(completed));

      // –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö
      db.ref("orders/" + key).remove();

      alert("–ó–∞–∫–∞–∑ –∑–∞–≤–µ—Ä—à–µ–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –∞—Ä—Ö–∏–≤!");
      location.reload();
    }
  </script>
</body>
</html>